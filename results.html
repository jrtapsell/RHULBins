<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.2.0/handlebars.min.js"
            integrity="sha256-fIuSfP8oRbwWG9pRr+FaGfBU62kYY+7YqUsXSCgnYqM="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://www.jrtapsell.co.uk/res/mdl/custom.css"/>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
</head>
<body>
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">RHUL Bins</span>
        </div>
    </header>
    <main class="mdl-layout__content">
        <div class="page-content mdl-grid">
            <div id="searchResults" class="mdl-cell--12-col mdl-grid"></div>
        </div>
    </main>
</div>
    <script>
      (async () => {
        const setupData = JSON.parse(atob(window.location.pathname.substring(1).replace("_", "/").replace("-", "+")))

        const templatePromise = fetch("/results.hbs")
          .then(p => p.text())
          .then(p => Handlebars.compile(p))

        const dataPromise = fetch("/api/lookup_bin_days.php?query=" + id)
          .then(p => p.json())

        const data = await dataPromise
        const template = await templatePromise

        const structuredData = [
          {"name": "Food Waste", "color": "IDK", "nextDate": data[0].nextFoodWasteDate},
          {"name": "General Waste", "color": "IDK", "nextDate": data[0].nextRefuseDate},
          {"name": "Recycling", "color": "IDK", "nextDate": data[0].nextRecyclingDate},
          {"name": "Garden Waste", "color": "IDK", "nextDate": data[0].nextGardenWasteDate},
          {"name": "Textiles and Electricals", "color": "IDK", "nextDate": data[0].nextTextilesElectricalsDate},
        ]


        document.querySelector("#searchResults").innerHTML = template(structuredData)
      })()
    </script>
</body>
</html>